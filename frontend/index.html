<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>POD Creator - v1.0.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="light only" />
<meta name="description" content="Print-on-demand store creator for DevMode" />
<style>
  :root { --fg:#111; --muted:#777; --accent:#111; --border:#e7e7e7; --ok:#0a7a2f; --bad:#b40000; --bg:#fafafa; }
  * { box-sizing: border-box; }
  body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; color: var(--fg); background: var(--bg); }
  h1 { font-size: 22px; margin: 0 0 12px; }
  h2 { font-size: 16px; margin: 0 0 8px; }
  .topbar { display:flex; gap:12px; align-items:center; margin-bottom: 16px; flex-wrap: wrap; }
  .inline { display:inline-flex; align-items:center; gap:8px; }
  select, input, textarea { font: inherit; }
  .select, .input, .textarea { padding: 6px 10px; border:1px solid var(--border); border-radius:8px; background:#fff; }
  .tabs { display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap; }
  .tab { padding:8px 12px; border:1px solid var(--border); border-radius:8px; cursor:pointer; background:#fff; }
  .tab.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  .grid { width: 100%; border-collapse: collapse; }
  .grid th, .grid td { border-bottom: 1px solid var(--border); padding: 8px; font-size: 14px; vertical-align: top; background:#fff; }
  .panel { border:1px solid var(--border); border-radius:12px; padding:16px; margin-bottom:16px; background:#fff; }
  .row { display:grid; grid-template-columns:1fr 360px; gap:16px; }
  .btn { padding:8px 12px; border:1px solid var(--border); border-radius:8px; cursor:pointer; background:#fff; }
  .btn + .btn { margin-left:8px; }
  .good { color:var(--ok); font-weight:600; }
  .bad { color:var(--bad); font-weight:600; }
  .muted { color:var(--muted); }
  .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; background:#f2f2f2; padding:2px 6px; border-radius:6px; }
  canvas { background-image: linear-gradient(45deg,#eee 25%,transparent 25%),linear-gradient(-45deg,#eee 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#eee 75%),linear-gradient(-45deg,transparent 75%,#eee 75%);
           background-size:20px 20px; background-position:0 0,0 10px,10px -10px,-10px 0px; border-radius: 8px; }
  .toast { position: fixed; right:16px; bottom:16px; background:#111; color:#fff; padding:10px 14px; border-radius:8px; display:none; box-shadow:0 8px 30px rgba(0,0,0,.25); }
  .help { font-size: 13px; color: var(--muted); }
  .split { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .pill { font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; background:#fff; display:inline-block; }
  .footer { margin-top:24px; font-size:12px; color:var(--muted); }
</style>
</head>
<body>
  <div class="topbar">
    <h1 style="margin-right:8px;">POD Creator</h1>
    <label class="inline">
      <span class="muted">App:</span>
      <select id="appSelect" class="select">
        <option value="devmode-asset-checker">DevMode Asset Checker</option>
        <option value="wescale-pod-console">WeScale POD Console</option>
      </select>
    </label>
    <button id="btnCheckUpdates" class="btn" title="Checks your repo for updates">Check for Updates</button>
    <span id="updateStatus" class="muted"></span>
    <span class="pill">Style A: DevMode 105px Â· Slogan 400px Â· #FFF Â· Transparent Â· Left-aligned</span>
  </div>

  <div class="tabs" id="tabs"></div>
  <div id="content"></div>
  <div id="toast" class="toast"></div>

<script>
/* =========================
   Configuration
   ========================= */
const LOCAL_VERSION = '1.0.0';
const UPDATE_URL = 'https://raw.githubusercontent.com/dquillman/POD-Store-Creator/main/frontend/updates.json';
// Backend API URL - will be auto-detected from Cloud Run or can be set manually
const API_URL = window.location.hostname === 'storage.googleapis.com'
  ? 'https://pod-creator-api-REPLACE_WITH_YOUR_CLOUD_RUN_HASH-uc.a.run.app'
  : 'http://localhost:8080';

/* =========================
   API Helper
   ========================= */
async function apiCall(endpoint, options = {}) {
  const url = `${API_URL}${endpoint}`;
  try {
    const res = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      }
    });
    const json = await res.json();
    if (!json.ok && json.error) throw new Error(json.error);
    return json;
  } catch (error) {
    console.error(`API call failed: ${endpoint}`, error);
    throw error;
  }
}

/* =========================
   Update channel (optional)
   ========================= */

async function checkForUpdates(){
  const s = document.getElementById('updateStatus'); s.textContent = 'Checkingâ€¦';
  try{
    const res = await fetch(UPDATE_URL, { cache:'no-store' });
    if(!res.ok) throw new Error('No updates file');
    const j = await res.json();
    const remote = j.schemaVersion || '0.0.0';
    if(remote !== LOCAL_VERSION){ toast('Update available: ' + remote); s.textContent = 'Update available: ' + remote; }
    else { s.textContent = 'Up to date'; toast('You are up to date.'); }
  }catch{ s.textContent = 'Couldnâ€™t check.'; }
}
document.getElementById('btnCheckUpdates').onclick = checkForUpdates;

/* =========================
   Specs for both tools
   ========================= */
const SPEC_DEVMODE = {
  appId:"devmode-asset-checker", title:"DevMode Asset Checker",
  tabs:[
    {id:"asset-audit",label:"Asset Audit"},
    {id:"store-setup",label:"Store Setup Flow"},
    {id:"settings",label:"Settings"}
  ]
};
const SPEC_POD = {
  appId:"wescale-pod-console", title:"WeScale POD Console",
  tabs:[
    {id:"niche",label:"Step 1 Â· Niche Research"},
    {id:"selector",label:"Mini-Audit"},
    {id:"brand",label:"Step 2â€“4 Â· Brand & Logo"},
    {id:"design-research",label:"Step 5 Â· Design Research"},
    {id:"design-generator",label:"Step 6 Â· Design Generator"},
    {id:"qa-export",label:"QA & Export"}
  ]
};
const SPEC_MAP = { [SPEC_DEVMODE.appId]:SPEC_DEVMODE, [SPEC_POD.appId]:SPEC_POD };
let spec = SPEC_DEVMODE;

/* =========================
   UI helpers
   ========================= */
function el(tag, attrs={}, children=[]){ const e=document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{ if(k==='class') e.className=v; else if(k==='html') e.innerHTML=v; else e.setAttribute(k,v);});
  (Array.isArray(children)?children:[children]).filter(Boolean).forEach(c=>e.appendChild(typeof c==='string'?document.createTextNode(c):c));
  return e;
}
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }

/* =========================
   State (Asset Checker)
   ========================= */
let files=[], checks=[], settings={ fontSizeDevMode:105, fontSizeSlogan:400, lineHeight:1.15, maxBgDelta:12 };

/* =========================
   Render shell
   ========================= */
document.getElementById('appSelect').onchange = e => { spec = SPEC_MAP[e.target.value]; render(); };
render();

function render(){
  const tabsEl = document.getElementById('tabs'); const content=document.getElementById('content');
  tabsEl.innerHTML=''; content.innerHTML='';
  spec.tabs.forEach((t,i)=>{ const btn = el('div',{class:'tab'+(i===0?' active':''),'data-idx':i},t.label); btn.onclick=()=>switchTab(i); tabsEl.appendChild(btn); });
  switchTab(0);
}
function switchTab(idx){
  [...document.querySelectorAll('.tab')].forEach((n,i)=>n.classList.toggle('active',i===idx));
  const tab = spec.tabs[idx]; const content=document.getElementById('content'); content.innerHTML='';
  if(spec.appId==='devmode-asset-checker'){
    if(tab.id==='asset-audit') content.appendChild(renderAuditTab());
    if(tab.id==='store-setup') content.appendChild(renderStoreTab());
    if(tab.id==='settings') content.appendChild(renderSettingsTab());
  }else{
    content.appendChild(renderPODScaffold());
  }
}

/* =========================
   DevMode Asset Checker
   ========================= */
let gridWrap=null;

function renderAuditTab(){
  const row = el('div',{class:'row'});
  // Left
  const left = el('div',{class:'panel'},[
    el('h2',{},'Upload & Inspect'),
    el('div',{},[
      (()=>{ const lbl=el('label',{class:'btn',style:'display:inline-block;'},'Upload PNGs');
        const input=el('input',{type:'file',multiple:true,accept:'.png',style:'display:none;'});
        lbl.onclick=()=>input.click();
        input.onchange=async e=>{ files=[...e.target.files]; checks=[]; await runChecks(); renderGrid(gridWrap); };
        return el('div',{},[lbl,input]); })(),
      el('span',{class:'help',style:'margin-left:8px;'},'Tip: hold '),
      el('span',{class:'kbd'},'Shift'),
      el('span',{class:'help'},' to select multiple files.')
    ]),
    el('div',{style:'margin-top:8px;'},[
      el('button',{class:'btn',onclick:async()=>{ await runChecks(); renderGrid(gridWrap); }},'Run Checks')
    ]),
    (gridWrap=el('div',{style:'margin-top:12px;'}))
  ]);
  // Right
  const right = el('div',{class:'panel'},[
    el('h2',{},'Preview'),
    el('canvas',{id:'previewCanvas',width:600,height:720}),
    el('div',{class:'help',style:'margin-top:8px;'},
      'Style A: DevMode 105px Â· Slogan 400px Â· #FFFFFF Â· transparent Â· left-aligned Â· no extra effects.')
  ]);
  row.append(left,right); renderGrid(gridWrap); return row;
}

function renderGrid(container){
  const wrap=el('div');
  const table=el('table',{class:'grid'});
  const head=el('tr',{},['File','Transparency','Background Detected','4500Ã—5400','Style A Heuristic','Actions'].map(h=>el('th',{},h)));
  table.appendChild(el('thead',{},head));
  const body=el('tbody');
  checks.forEach((r,idx)=>{
    const tr=el('tr',{},[
      el('td',{},r.name),
      el('td',{},el('span',{class:r.hasTransparency?'good':'bad'},r.hasTransparency?'Yes':'No')),
      el('td',{},el('span',{class:r.bgLikely?'bad':'good'},r.bgLikely?'Yes':'No')),
      el('td',{},el('span',{class:r.sizeOk?'good':'bad'},r.sizeOk?'OK':'Mismatch')),
      el('td',{},el('span',{class:r.styleAOk?'good':'bad'},r.styleAOk?'OK':'Check')),
      el('td',{},[
        el('button',{class:'btn',onclick:()=>preview(idx)},'Preview'),
        el('button',{class:'btn',onclick:()=>removeBG(idx,'white')},'Remove BG (white)'),
        el('button',{class:'btn',onclick:()=>removeBG(idx,'black')},'Remove BG (black)'),
        el('button',{class:'btn',onclick:()=>exportPNG(idx)},'Export Clean')
      ])
    ]);
    body.appendChild(tr);
  });
  table.appendChild(body);
  wrap.appendChild(table);
  container.innerHTML=''; container.appendChild(wrap);
}

async function runChecks(){
  checks = await Promise.all(files.map(async f=>{
    const img = await readImage(f); const meta = await analyze(img);
    return { name:f.name, file:f, ...meta, _img:img };
  }));
}
function readImage(file){ return new Promise(res=>{ const url=URL.createObjectURL(file); const img=new Image(); img.onload=()=>res(img); img.src=url; }); }

async function analyze(img){
  const w=img.naturalWidth, h=img.naturalHeight;
  const c=document.createElement('canvas'); c.width=w; c.height=h; const x=c.getContext('2d'); x.drawImage(img,0,0);
  const d=x.getImageData(0,0,w,h).data; const sample=(sx,sy)=>{ const i=(sy*w+sx)*4; return [d[i],d[i+1],d[i+2],d[i+3]]; };

  const sizeOk=(w===4500 && h===5400);

  // Transparency and border-opaque sampling â†’ background heuristic
  let alpha=0, borderOpaque=0, borderSamples=0;
  const stepX=Math.max(1,Math.floor(w/200)), stepY=Math.max(1,Math.floor(h/200));
  for(let x0=0;x0<w;x0+=stepX){ [[x0,0],[x0,h-1]].forEach(([sx,sy])=>{ borderSamples++; if(sample(sx,sy)[3]>0) borderOpaque++; }); }
  for(let y0=0;y0<h;y0+=stepY){ [[0,y0],[w-1,y0]].forEach(([sx,sy])=>{ borderSamples++; if(sample(sx,sy)[3]>0) borderOpaque++; }); }
  for(let y=0;y<h;y+=stepY){ for(let x1=0;x1<w;x1+=stepX){ const a=sample(x1,y)[3]; if(a===0) alpha++; } }

  const hasTransparency = alpha>0;
  const bgLikely = (borderOpaque/borderSamples)>0.5;

  // Style A rough check: sufficient white pixels near top-left region
  const tol=16; let whitePix=0;
  for(let y=0;y<Math.min(400,h);y+=8){
    for(let x2=0;x2<Math.min(800,w);x2+=8){
      const [r,g,b,a]=sample(x2,y);
      if(a>0 && Math.abs(255-r)<tol && Math.abs(255-g)<tol && Math.abs(255-b)<tol) whitePix++;
    }
  }
  const styleAOk = hasTransparency && !bgLikely && whitePix>100;
  return { hasTransparency, bgLikely, sizeOk, styleAOk };
}

function preview(idx){
  const row=checks[idx];
  const cvs=document.getElementById('previewCanvas'); const ctx=cvs.getContext('2d');
  ctx.clearRect(0,0,cvs.width,cvs.height);
  const ratio=Math.min(cvs.width/row._img.naturalWidth,cvs.height/row._img.naturalHeight);
  const w=Math.round(row._img.naturalWidth*ratio), h=Math.round(row._img.naturalHeight*ratio);
  ctx.drawImage(row._img,0,0,w,h);
}

function removeBG(idx,mode='white'){
  const row=checks[idx]; const w=row._img.naturalWidth, h=row._img.naturalHeight;
  const c=document.createElement('canvas'); c.width=w; c.height=h; const x=c.getContext('2d'); x.drawImage(row._img,0,0);
  const imgd=x.getImageData(0,0,w,h); const d=imgd.data; const fuzz=settings.maxBgDelta||12;
  const isWhite=(r,g,b)=>r>=255-fuzz&&g>=255-fuzz&&b>=255-fuzz;
  const isBlack=(r,g,b)=>r<=fuzz&&g<=fuzz&&b<=fuzz;
  for(let i=0;i<d.length;i+=4){
    const r=d[i],g=d[i+1],b=d[i+2],a=d[i+3];
    if(a===0) continue;
    if(mode==='white'&&isWhite(r,g,b)) d[i+3]=0;
    if(mode==='black'&&isBlack(r,g,b)) d[i+3]=0;
  }
  x.putImageData(imgd,0,0);
  const url=c.toDataURL('image/png'); const img=new Image(); img.onload=()=>{ checks[idx]._img=img; preview(idx); render(); }; img.src=url;
}

function exportPNG(idx){
  const row=checks[idx];
  const c=document.createElement('canvas'); c.width=row._img.naturalWidth; c.height=row._img.naturalHeight;
  c.getContext('2d').drawImage(row._img,0,0);
  const a=document.createElement('a'); a.download=row.name.replace(/\.png$/i,'_clean.png'); a.href=c.toDataURL('image/png'); a.click();
}

/* =========================
   Store Setup (checklist)
   ========================= */
function renderStoreTab(){
  const steps = [
    "Lock DevMode Style A (font sizes, spacing)",
    "Generate & approve slogans",
    "Batch export transparent PNGs 4500Ã—5400",
    "Create PDP mockups (dark tees + hoodies)",
    "Create listings (title, bullets, tags)",
    "SEO pass (keywords, alt text)",
    "Pricing & profit check ($28â€“$35 tees)",
    "Publish to storefronts",
    "Final QA: thumbnail contrast, readability"
  ];
  const key='pod-creator-store-flow';
  const saved = JSON.parse(localStorage.getItem(key)||'{}');

  const list = el('div');
  steps.forEach((txt,i)=>{
    const id='s'+i, checked=!!saved[id];
    const row = el('label',{style:'display:flex;align-items:center;gap:8px;margin:6px 0;cursor:pointer;'},[
      el('input',{type:'checkbox',checked:checked?'checked':null,onchange:(e)=>{ saved[id]=e.target.checked; localStorage.setItem(key,JSON.stringify(saved)); }}),
      el('span',{},txt)
    ]);
    list.appendChild(row);
  });

  return el('div',{class:'panel'},[
    el('h2',{},'Finish Store Setup'),
    list,
    el('div',{class:'help',style:'margin-top:8px;'},'Progress is saved in your browser (localStorage).')
  ]);
}

/* =========================
   Settings
   ========================= */
function renderSettingsTab(){
  const wrap = el('div',{class:'panel'},[
    el('h2',{},'Settings'),
    labeled('DevMode font size (px)', String(settings.fontSizeDevMode), v=>settings.fontSizeDevMode=Number(v)),
    labeled('Slogan font size (px)', String(settings.fontSizeSlogan), v=>settings.fontSizeSlogan=Number(v)),
    labeled('Line height (em)', String(settings.lineHeight), v=>settings.lineHeight=Number(v)),
    labeled('BG detect tolerance (0â€“255)', String(settings.maxBgDelta), v=>settings.maxBgDelta=Number(v)),
    el('div',{class:'help',style:'margin-top:6px;'},'Note: PNGs donâ€™t reliably store DPI; 4500Ã—5400 px is interpreted as 300 DPI at print.')
  ]);
  return wrap;

  function labeled(label,value,onchange){
    const input = el('input',{class:'input',value,style:'width:140px;'});
    input.onchange = e=>onchange(e.target.value);
    return el('div',{style:'margin:8px 0;display:flex;align-items:center;gap:8px;'},
      [ el('div',{style:'width:260px;'},label), input ]);
  }
}

/* =========================
   POD Console (full implementation)
   ========================= */
let podData = { trends: [], prompts: [], mockups: [], listings: [] };

function renderPODScaffold(){
  return el('div',{},[
    el('div',{class:'panel'},[
      el('h2',{},'POD Workflow Console'),
      el('div',{class:'help'},'Complete workflow: Research â†’ Design â†’ Mockups â†’ Listings â†’ Publish')
    ]),

    // Research Section
    el('div',{class:'split',style:'margin-top:12px;'},[
      el('div',{class:'panel'},[
        el('h2',{},'1. Design Research'),
        el('div',{class:'help'},'Generate trending design ideas for your niche'),
        el('div',{style:'margin:8px 0;'},[
          el('label',{},'Niche: '),
          el('input',{id:'nicheInput',class:'input',value:'developer',style:'width:200px;margin-left:8px;'})
        ]),
        el('button',{class:'btn',onclick:generateTrends},'Generate Trends'),
        el('div',{id:'trendsOutput',style:'margin-top:12px;'})
      ]),
      el('div',{class:'panel'},[
        el('h2',{},'2. Design Prompts'),
        el('div',{class:'help'},'Create specific t-shirt design prompts'),
        el('div',{style:'margin:8px 0;'},[
          el('label',{},'Style: '),
          el('select',{id:'styleInput',class:'select',style:'margin-left:8px;'},[
            el('option',{value:'minimalist'},'Minimalist'),
            el('option',{value:'retro'},'Retro'),
            el('option',{value:'bold'},'Bold'),
            el('option',{value:'funny'},'Funny')
          ])
        ]),
        el('button',{class:'btn',onclick:generatePrompts},'Generate Prompts'),
        el('div',{id:'promptsOutput',style:'margin-top:12px;'})
      ])
    ]),

    // Mockups & Listings Section
    el('div',{class:'split',style:'margin-top:12px;'},[
      el('div',{class:'panel'},[
        el('h2',{},'3. Generate Mockups'),
        el('div',{class:'help'},'Create product mockups from your designs'),
        el('div',{style:'margin:8px 0;'},[
          el('label',{},'Image URL: '),
          el('input',{id:'mockupImageUrl',class:'input',placeholder:'https://...',style:'width:100%;margin-top:4px;'})
        ]),
        el('button',{class:'btn',onclick:generateMockup},'Create Mockup'),
        el('div',{id:'mockupOutput',style:'margin-top:12px;'})
      ]),
      el('div',{class:'panel'},[
        el('h2',{},'4. Create Listing'),
        el('div',{class:'help'},'Build Shopify product listing'),
        el('div',{style:'margin:8px 0;'},[
          el('label',{},'Title: '),
          el('input',{id:'listingTitle',class:'input',placeholder:'Product title',style:'width:100%;margin-top:4px;'}),
          el('label',{style:'margin-top:8px;'},'Price: '),
          el('input',{id:'listingPrice',class:'input',value:'29.99',style:'width:100px;margin-left:8px;'})
        ]),
        el('button',{class:'btn',onclick:createListing},'Create Listing'),
        el('div',{id:'listingOutput',style:'margin-top:12px;'})
      ])
    ]),

    // Publish Section
    el('div',{class:'panel',style:'margin-top:12px;'},[
      el('h2',{},'5. Publish Product'),
      el('div',{class:'help'},'Publish draft product to your store'),
      el('div',{style:'margin:8px 0;'},[
        el('label',{},'Listing ID: '),
        el('input',{id:'publishListingId',class:'input',placeholder:'From step 4',style:'width:200px;margin-left:8px;'})
      ]),
      el('button',{class:'btn',onclick:publishProduct},'Publish to Store'),
      el('div',{id:'publishOutput',style:'margin-top:12px;'})
    ]),

    // Store Status Upload
    el('div',{class:'panel',style:'margin-top:12px;'},[
      el('h2',{},'Store Status Check'),
      el('div',{class:'help'},'Upload store_status_report.json from your local checker'),
      el('div',{style:'margin:8px 0;'},[
        (()=>{
          const lbl=el('label',{class:'btn',style:'display:inline-block;'},'Upload Status Report');
          const input=el('input',{type:'file',accept:'.json',style:'display:none;'});
          lbl.onclick=()=>input.click();
          input.onchange=async e=>{ await uploadStoreStatus(e.target.files[0]); };
          return el('div',{},[lbl,input]);
        })()
      ]),
      el('div',{id:'statusOutput',style:'margin-top:12px;'})
    ])
  ]);
}

// Generate Trends
async function generateTrends(){
  const niche = document.getElementById('nicheInput').value || 'developer';
  const output = document.getElementById('trendsOutput');
  output.innerHTML = 'Loading...';

  try {
    const result = await apiCall('/api/trends', {
      method: 'POST',
      body: JSON.stringify({ niche, keywords: [] })
    });

    podData.trends = result.trends || [];
    const list = el('ol',{style:'margin:8px 0;padding-left:20px;'});
    result.trends.forEach(t => list.appendChild(el('li',{style:'margin:4px 0;'},t)));
    output.innerHTML = '';
    output.appendChild(el('div',{class:'good',style:'margin-bottom:8px;'},'âœ“ Generated ' + result.trends.length + ' trends'));
    output.appendChild(list);
    toast('Trends generated!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}

// Generate Prompts
async function generatePrompts(){
  const niche = document.getElementById('nicheInput').value || 'developer';
  const style = document.getElementById('styleInput').value || 'minimalist';
  const output = document.getElementById('promptsOutput');
  output.innerHTML = 'Loading...';

  try {
    const result = await apiCall('/api/prompts', {
      method: 'POST',
      body: JSON.stringify({ niche, style, count: 10 })
    });

    podData.prompts = result.prompts || [];
    const list = el('ol',{style:'margin:8px 0;padding-left:20px;font-size:13px;'});
    result.prompts.forEach(p => list.appendChild(el('li',{style:'margin:6px 0;'},p)));
    output.innerHTML = '';
    output.appendChild(el('div',{class:'good',style:'margin-bottom:8px;'},'âœ“ Generated ' + result.prompts.length + ' prompts'));
    output.appendChild(list);
    toast('Prompts generated!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}

// Generate Mockup
async function generateMockup(){
  const imageUrl = document.getElementById('mockupImageUrl').value;
  const output = document.getElementById('mockupOutput');

  if (!imageUrl) {
    toast('Please enter an image URL');
    return;
  }

  output.innerHTML = 'Generating mockup... (this may take 10-20 seconds)';

  try {
    const result = await apiCall('/api/mockup', {
      method: 'POST',
      body: JSON.stringify({ imageUrl, productId: 71, variantId: 4012 })
    });

    podData.mockups = result.mockups || [];
    output.innerHTML = '';
    output.appendChild(el('div',{class:'good',style:'margin-bottom:8px;'},'âœ“ Mockup generated'));

    if (result.mockups && result.mockups.length > 0) {
      result.mockups.forEach(m => {
        output.appendChild(el('img',{src:m.url,style:'max-width:200px;margin:8px;border:1px solid #ddd;border-radius:4px;'}));
      });
    }

    if (result.message) {
      output.appendChild(el('div',{class:'help',style:'margin-top:8px;'},result.message));
    }

    toast('Mockup ready!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}

// Create Listing
async function createListing(){
  const title = document.getElementById('listingTitle').value;
  const price = parseFloat(document.getElementById('listingPrice').value) || 29.99;
  const output = document.getElementById('listingOutput');

  if (!title) {
    toast('Please enter a product title');
    return;
  }

  output.innerHTML = 'Creating listing...';

  try {
    const images = podData.mockups.map(m => m.url);
    const result = await apiCall('/api/listing', {
      method: 'POST',
      body: JSON.stringify({
        title,
        description: `${title} - High quality print-on-demand apparel`,
        tags: ['devmode', 'developer', 'coding'],
        price,
        images
      })
    });

    output.innerHTML = '';
    output.appendChild(el('div',{class:'good',style:'margin-bottom:8px;'},'âœ“ Listing created'));
    output.appendChild(el('div',{},[
      el('strong',{},'Listing ID: '),
      el('span',{},result.listingId)
    ]));

    if (result.adminUrl) {
      output.appendChild(el('div',{style:'margin-top:8px;'},[
        el('a',{href:result.adminUrl,target:'_blank',class:'btn'},'View in Shopify Admin')
      ]));
    }

    if (result.message) {
      output.appendChild(el('div',{class:'help',style:'margin-top:8px;'},result.message));
    }

    document.getElementById('publishListingId').value = result.listingId;
    toast('Listing created!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}

// Publish Product
async function publishProduct(){
  const listingId = document.getElementById('publishListingId').value;
  const output = document.getElementById('publishOutput');

  if (!listingId) {
    toast('Please enter a listing ID');
    return;
  }

  output.innerHTML = 'Publishing...';

  try {
    const result = await apiCall('/api/publish', {
      method: 'POST',
      body: JSON.stringify({ listingId })
    });

    output.innerHTML = '';
    output.appendChild(el('div',{class:'good',style:'margin-bottom:8px;'},'âœ“ Product published!'));

    if (result.url) {
      output.appendChild(el('div',{style:'margin-top:8px;'},[
        el('strong',{},'Store URL: '),
        el('a',{href:result.url,target:'_blank'},result.url)
      ]));
    }

    if (result.adminUrl) {
      output.appendChild(el('div',{style:'margin-top:8px;'},[
        el('a',{href:result.adminUrl,target:'_blank',class:'btn'},'View in Shopify Admin')
      ]));
    }

    if (result.message) {
      output.appendChild(el('div',{class:'help',style:'margin-top:8px;'},result.message));
    }

    toast('Product is live!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}

// Upload Store Status
async function uploadStoreStatus(file){
  if (!file) return;

  const output = document.getElementById('statusOutput');
  output.innerHTML = 'Analyzing...';

  try {
    const text = await file.text();
    const report = JSON.parse(text);

    const result = await apiCall('/api/store-status', {
      method: 'POST',
      body: JSON.stringify(report)
    });

    const analysis = result.analysis;
    output.innerHTML = '';

    output.appendChild(el('div',{class:'good',style:'margin-bottom:12px;'},'âœ“ Report analyzed'));
    output.appendChild(el('div',{style:'font-size:16px;font-weight:600;margin-bottom:8px;'},[
      el('span',{},'Completion: '),
      el('span',{class:analysis.completionPercentage >= 80 ? 'good' : 'bad'},analysis.completionPercentage + '%')
    ]));

    if (analysis.missingSteps.length > 0) {
      output.appendChild(el('div',{style:'margin-top:12px;'},[
        el('strong',{},'Missing Steps:'),
        el('ul',{style:'margin:8px 0;padding-left:20px;'},
          analysis.missingSteps.map(s => el('li',{},s))
        )
      ]));
    }

    if (analysis.recommendations.length > 0) {
      output.appendChild(el('div',{style:'margin-top:12px;'},[
        el('strong',{},'Recommendations:'),
        el('ul',{style:'margin:8px 0;padding-left:20px;'},
          analysis.recommendations.map(r => el('li',{},r))
        )
      ]));
    }

    if (analysis.readyForLaunch) {
      output.appendChild(el('div',{class:'good',style:'margin-top:12px;font-weight:600;'},'ðŸŽ‰ Your store is ready to launch!'));
    }

    toast('Store status analyzed!');
  } catch (error) {
    output.innerHTML = '';
    output.appendChild(el('div',{class:'bad'},'Error: ' + error.message));
  }
}
</script>
</body>
</html>
